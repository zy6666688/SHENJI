# å®¡è®¡æ•°æ™ºæ - éƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### ç¯å¢ƒå‡†å¤‡ âœ…

- [ ] Node.js 18.x/20.x å·²å®‰è£…å¹¶éªŒè¯
- [ ] PostgreSQL 14.x+ å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] Redis 6.x+ å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] Nginx å·²å®‰è£…å¹¶é…ç½®
- [ ] PM2 å·²å®‰è£…
- [ ] ç£ç›˜ç©ºé—´å……è¶³ (è‡³å°‘20GBå¯ç”¨)
- [ ] å†…å­˜å……è¶³ (è‡³å°‘4GBå¯ç”¨)

###ä»£ç å‡†å¤‡ âœ…

- [ ] ä»£ç å·²ä»Gitä»“åº“å…‹éš†
- [ ] åˆ‡æ¢åˆ°æ­£ç¡®çš„åˆ†æ”¯/æ ‡ç­¾
- [ ] æ‰€æœ‰ä¾èµ–å·²å®‰è£… (`npm install`)
- [ ] åç«¯ä»£ç å·²æ„å»º (`npm run build`)
- [ ] å‰ç«¯ä»£ç å·²æ„å»º (`npm run build`)
- [ ] æµ‹è¯•å·²é€šè¿‡ (`npm test`)

### é…ç½®æ£€æŸ¥ âœ…

- [ ] `.env` æ–‡ä»¶å·²åˆ›å»ºå¹¶é…ç½®
- [ ] æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®
  - [ ] DATABASE_URL å·²é…ç½®
  - [ ] æ•°æ®åº“ç”¨æˆ·å·²åˆ›å»º
  - [ ] æ•°æ®åº“æƒé™å·²æˆäºˆ
- [ ] Redisé…ç½®æ­£ç¡®
  - [ ] REDIS_URL å·²é…ç½®
  - [ ] Rediså¯è¿æ¥
- [ ] JWTå¯†é’¥å·²ç”Ÿæˆå¹¶é…ç½®
- [ ] Sessionå¯†é’¥å·²ç”Ÿæˆå¹¶é…ç½®
- [ ] æ–‡ä»¶ä¸Šä¼ ç›®å½•å·²é…ç½®
- [ ] æ—¥å¿—ç›®å½•å·²åˆ›å»º
- [ ] å·¥ä½œæµå­˜å‚¨ç›®å½•å·²åˆ›å»º
- [ ] æ‰§è¡Œå†å²å­˜å‚¨ç›®å½•å·²åˆ›å»º

### æ•°æ®åº“è¿ç§» âœ…

- [ ] Prisma Client å·²ç”Ÿæˆ
- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
- [ ] ç§å­æ•°æ®å·²å¯¼å…¥ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ•°æ®åº“ç´¢å¼•å·²åˆ›å»º
- [ ] æ•°æ®åº“å¤‡ä»½æœºåˆ¶å·²é…ç½®

### æœåŠ¡é…ç½® âœ…

- [ ] PM2é…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] æˆ– systemdæœåŠ¡æ–‡ä»¶å·²åˆ›å»º
- [ ] æ—¥å¿—è½®è½¬å·²é…ç½®
- [ ] è‡ªåŠ¨é‡å¯å·²å¯ç”¨
- [ ] å¼€æœºè‡ªå¯å·²é…ç½®

### ç½‘ç»œé…ç½® âœ…

- [ ] Nginxé…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] é™æ€æ–‡ä»¶è·¯å¾„æ­£ç¡®
- [ ] APIä»£ç†é…ç½®æ­£ç¡®
- [ ] WebSocketä»£ç†é…ç½®æ­£ç¡®
- [ ] SSLè¯ä¹¦å·²é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½®
- [ ] CORSé…ç½®æ­£ç¡®

### å®‰å…¨æ£€æŸ¥ âœ…

- [ ] æ•æ„Ÿä¿¡æ¯ä¸åœ¨ä»£ç åº“ä¸­
- [ ] å¼ºå¯†ç å·²è®¾ç½®
- [ ] æ•°æ®åº“åªå…è®¸æœ¬åœ°è¿æ¥
- [ ] åç«¯ç«¯å£ä¸å¯¹å¤–æš´éœ²
- [ ] æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶å·²é…ç½®
- [ ] è¾“å…¥éªŒè¯å·²å®ç°
- [ ] SQLæ³¨å…¥é˜²æŠ¤å·²å¯ç”¨
- [ ] XSSé˜²æŠ¤å·²å¯ç”¨

### ç›‘æ§å‘Šè­¦ âœ…

- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹å¯è®¿é—®
- [ ] æ—¥å¿—æ­£å¸¸è¾“å‡º
- [ ] PM2ç›‘æ§å·²å¯ç”¨
- [ ] ç£ç›˜ç©ºé—´ç›‘æ§å·²é…ç½®
- [ ] é”™è¯¯å‘Šè­¦å·²é…ç½®
- [ ] æ€§èƒ½ç›‘æ§å·²é…ç½®

### å¤‡ä»½ç­–ç•¥ âœ…

- [ ] æ•°æ®åº“å¤‡ä»½è„šæœ¬å·²åˆ›å»º
- [ ] æ•°æ®åº“å¤‡ä»½å®šæ—¶ä»»åŠ¡å·²é…ç½®
- [ ] æ–‡ä»¶æ•°æ®å¤‡ä»½ç­–ç•¥å·²å®æ–½
- [ ] å¤‡ä»½æ¢å¤æµç¨‹å·²æµ‹è¯•

---

## ğŸš€ éƒ¨ç½²æ‰§è¡Œæ¸…å•

### 1. åœæ­¢æ—§æœåŠ¡

```bash
[ ] pm2 stop audit-backend
[ ] æˆ– sudo systemctl stop audit-backend
```

### 2. æ›´æ–°ä»£ç 

```bash
[ ] cd /opt/SHENJI
[ ] git pull origin master
[ ] æˆ– git checkout <tag>
```

### 3. å®‰è£…ä¾èµ–

```bash
[ ] npm install
[ ] cd packages/backend && npm install
[ ] cd packages/frontend && npm install
```

### 4. æ•°æ®åº“è¿ç§»

```bash
[ ] npx prisma migrate deploy
[ ] npx prisma generate
```

### 5. æ„å»ºä»£ç 

```bash
[ ] cd packages/backend && npm run build
[ ] cd packages/frontend && npm run build
```

### 6. å¯åŠ¨æœåŠ¡

```bash
[ ] pm2 restart audit-backend
[ ] æˆ– sudo systemctl start audit-backend
```

### 7. éªŒè¯éƒ¨ç½²

```bash
[ ] curl http://localhost:3000/health
[ ] curl http://localhost:3000/api/v2/workflows/stats
[ ] curl http://localhost:3000/api/v2/executions/stats
```

### 8. é‡è½½ Nginx

```bash
[ ] sudo nginx -t
[ ] sudo systemctl reload nginx
```

---

## âœ… éƒ¨ç½²åéªŒè¯æ¸…å•

### åŸºç¡€åŠŸèƒ½éªŒè¯

- [ ] é¦–é¡µå¯è®¿é—®
- [ ] ç”¨æˆ·å¯ç™»å½•
- [ ] APIå“åº”æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] Redisè¿æ¥æ­£å¸¸

### å·¥ä½œæµåŠŸèƒ½éªŒè¯

- [ ] åˆ›å»ºå·¥ä½œæµ
  ```bash
  curl -X POST http://localhost:3000/api/v2/workflows \
    -H "Content-Type: application/json" \
    -d '{"name":"Test Workflow","description":"Test"}'
  ```

- [ ] æŸ¥è¯¢å·¥ä½œæµåˆ—è¡¨
  ```bash
  curl http://localhost:3000/api/v2/workflows
  ```

- [ ] éªŒè¯å·¥ä½œæµ
  ```bash
  curl -X POST http://localhost:3000/api/v2/workflows/validate \
    -H "Content-Type: application/json" \
    -d @test-workflow.json
  ```

### æ‰§è¡Œå¼•æ“éªŒè¯

- [ ] åˆ›å»ºæ‰§è¡Œ
  ```bash
  curl -X POST http://localhost:3000/api/v2/executions \
    -H "Content-Type: application/json" \
    -d '{"workflowId":"<workflow-id>","trigger":{"type":"manual"}}'
  ```

- [ ] æŸ¥è¯¢æ‰§è¡Œåˆ—è¡¨
  ```bash
  curl http://localhost:3000/api/v2/executions
  ```

- [ ] è·å–æ‰§è¡Œç»Ÿè®¡
  ```bash
  curl http://localhost:3000/api/v2/executions/stats
  ```

### ç›‘æ§åŠŸèƒ½éªŒè¯

- [ ] å®æ—¶è¿›åº¦æŸ¥è¯¢
- [ ] æ‰§è¡Œæ—¥å¿—æŸ¥è¯¢
- [ ] æ€§èƒ½æŒ‡æ ‡æŸ¥è¯¢
- [ ] WebSocketè¿æ¥æµ‹è¯•

### é«˜çº§åŠŸèƒ½éªŒè¯

- [ ] å›æ»šåŠŸèƒ½æµ‹è¯•
- [ ] æ–­ç‚¹ç»­ä¼ æµ‹è¯•
- [ ] é‡è¯•æœºåˆ¶æµ‹è¯•
- [ ] å–æ¶ˆæ‰§è¡Œæµ‹è¯•

### æ€§èƒ½éªŒè¯

- [ ] APIå“åº”æ—¶é—´ < 200ms
- [ ] å¹¶å‘æµ‹è¯•ï¼ˆ100ç”¨æˆ·ï¼‰
- [ ] é•¿æ—¶é—´è¿è¡Œæµ‹è¯•ï¼ˆ24å°æ—¶ï¼‰
- [ ] å†…å­˜ä½¿ç”¨æ­£å¸¸
- [ ] CPUä½¿ç”¨æ­£å¸¸

### æ—¥å¿—éªŒè¯

- [ ] åº”ç”¨æ—¥å¿—æ­£å¸¸è¾“å‡º
- [ ] PM2æ—¥å¿—å¯æŸ¥çœ‹
- [ ] Nginxè®¿é—®æ—¥å¿—è®°å½•
- [ ] Nginxé”™è¯¯æ—¥å¿—è®°å½•
- [ ] æ•°æ®åº“æ—¥å¿—è®°å½•

### å‘Šè­¦éªŒè¯

- [ ] æœåŠ¡å®•æœºå‘Šè­¦è§¦å‘
- [ ] ç£ç›˜ç©ºé—´å‘Šè­¦è§¦å‘
- [ ] é”™è¯¯ç‡å‘Šè­¦è§¦å‘
- [ ] æ€§èƒ½é™çº§å‘Šè­¦è§¦å‘

---

## ğŸ”¥ åº”æ€¥å“åº”æ¸…å•

### æœåŠ¡æ— å“åº”

1. [ ] æ£€æŸ¥è¿›ç¨‹çŠ¶æ€: `pm2 status`
2. [ ] æŸ¥çœ‹æ—¥å¿—: `pm2 logs audit-backend`
3. [ ] æ£€æŸ¥ç«¯å£: `netstat -nltp | grep 3000`
4. [ ] é‡å¯æœåŠ¡: `pm2 restart audit-backend`
5. [ ] æ£€æŸ¥å¥åº·: `curl http://localhost:3000/health`

### æ•°æ®åº“è¿æ¥å¤±è´¥

1. [ ] æ£€æŸ¥PostgreSQLçŠ¶æ€: `sudo systemctl status postgresql`
2. [ ] æµ‹è¯•è¿æ¥: `psql -U audit_user -d audit_engine`
3. [ ] æ£€æŸ¥è¿æ¥æ•°: `SELECT count(*) FROM pg_stat_activity;`
4. [ ] é‡å¯PostgreSQL: `sudo systemctl restart postgresql`

### Redisè¿æ¥å¤±è´¥

1. [ ] æ£€æŸ¥RedisçŠ¶æ€: `sudo systemctl status redis`
2. [ ] æµ‹è¯•è¿æ¥: `redis-cli ping`
3. [ ] æ£€æŸ¥å†…å­˜: `redis-cli INFO memory`
4. [ ] é‡å¯Redis: `sudo systemctl restart redis`

### å†…å­˜ä¸è¶³

1. [ ] æŸ¥çœ‹å†…å­˜: `free -h`
2. [ ] æŸ¥çœ‹è¿›ç¨‹: `ps aux --sort=-%mem | head`
3. [ ] é‡å¯æœåŠ¡: `pm2 restart audit-backend`
4. [ ] æ¸…ç†ç¼“å­˜: `sync; echo 3 > /proc/sys/vm/drop_caches`

### ç£ç›˜ç©ºé—´ä¸è¶³

1. [ ] æŸ¥çœ‹ç©ºé—´: `df -h`
2. [ ] æŸ¥æ‰¾å¤§æ–‡ä»¶: `du -h --max-depth=1 /opt/SHENJI | sort -hr`
3. [ ] æ¸…ç†æ—¥å¿—: `find /opt/SHENJI/logs -name "*.log" -mtime +7 -delete`
4. [ ] æ¸…ç†æ—§æ‰§è¡Œ: `curl -X POST http://localhost:3000/api/v2/executions/cleanup`

---

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | æ­£å¸¸èŒƒå›´ | å‘Šè­¦é˜ˆå€¼ | å¤„ç†æ–¹æ¡ˆ |
|------|---------|---------|---------|
| CPUä½¿ç”¨ç‡ | < 70% | > 85% | å¢åŠ å®ä¾‹/ä¼˜åŒ–ä»£ç  |
| å†…å­˜ä½¿ç”¨ç‡ | < 80% | > 90% | é‡å¯æœåŠ¡/å¢åŠ å†…å­˜ |
| ç£ç›˜ä½¿ç”¨ç‡ | < 70% | > 85% | æ¸…ç†æ•°æ®/æ‰©å®¹ |
| APIå“åº”æ—¶é—´ | < 200ms | > 1000ms | ä¼˜åŒ–æŸ¥è¯¢/å¢åŠ ç¼“å­˜ |
| é”™è¯¯ç‡ | < 1% | > 5% | æŸ¥çœ‹æ—¥å¿—/ä¿®å¤bug |
| æ•°æ®åº“è¿æ¥æ•° | < 50 | > 80 | ä¼˜åŒ–è¿æ¥æ±  |

---

## ğŸ”„ å›æ»šæµç¨‹

### å¿«é€Ÿå›æ»š (< 5åˆ†é’Ÿ)

1. [ ] åœæ­¢æœåŠ¡: `pm2 stop audit-backend`
2. [ ] åˆ‡æ¢ç‰ˆæœ¬: `git checkout <previous-tag>`
3. [ ] é‡æ–°æ„å»º: `cd packages/backend && npm run build`
4. [ ] å¯åŠ¨æœåŠ¡: `pm2 start audit-backend`
5. [ ] éªŒè¯åŠŸèƒ½

### å®Œæ•´å›æ»š (< 15åˆ†é’Ÿ)

1. [ ] åœæ­¢æœåŠ¡
2. [ ] å›æ»šæ•°æ®åº“: `psql -U audit_user audit_engine < backup.sql`
3. [ ] æ¢å¤æ–‡ä»¶: `cp -r /backup/data/* /opt/SHENJI/data/`
4. [ ] åˆ‡æ¢ä»£ç ç‰ˆæœ¬
5. [ ] é‡æ–°æ„å»º
6. [ ] å¯åŠ¨æœåŠ¡
7. [ ] å…¨é¢éªŒè¯

---

## ğŸ“ è”ç³»æ–¹å¼

### æŠ€æœ¯å›¢é˜Ÿ

- **è¿ç»´è´Ÿè´£äºº**: 
- **å¼€å‘è´Ÿè´£äºº**: 
- **DBA**: 
- **ç´§æ€¥è”ç³»**: 

### å¤–éƒ¨æ”¯æŒ

- **äº‘æœåŠ¡å•†**: 
- **æŠ€æœ¯æ”¯æŒ**: support@example.com
- **ç´§æ€¥çƒ­çº¿**: +86 xxx-xxxx-xxxx

---

## ğŸ“ éƒ¨ç½²è®°å½•

### éƒ¨ç½²ä¿¡æ¯

- **éƒ¨ç½²æ—¥æœŸ**: _______________
- **éƒ¨ç½²äººå‘˜**: _______________
- **ç‰ˆæœ¬å·**: _______________
- **Git Commit**: _______________

### å˜æ›´å†…å®¹

- [ ] åŠŸèƒ½æ›´æ–°
- [ ] Bugä¿®å¤
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å®‰å…¨åŠ å›º

### è¯¦ç»†è¯´æ˜

```
åœ¨æ­¤è®°å½•æœ¬æ¬¡éƒ¨ç½²çš„è¯¦ç»†å˜æ›´å†…å®¹...
```

### é‡åˆ°çš„é—®é¢˜

```
è®°å½•éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ...
```

### éªŒè¯ç»“æœ

- [ ] æ‰€æœ‰æ£€æŸ¥é¡¹å·²é€šè¿‡
- [ ] åŠŸèƒ½éªŒè¯å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] ç›‘æ§æ­£å¸¸

### å®¡æ‰¹

- **å®¡æ‰¹äºº**: _______________
- **å®¡æ‰¹æ—¥æœŸ**: _______________
- **å®¡æ‰¹æ„è§**: _______________

---

**æ£€æŸ¥æ¸…å•ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ4æ—¥  
**ç»´æŠ¤**: SHENJI Team
